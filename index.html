<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" href="spiral-favicon-32.png" type="image/png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="color-scheme" content="light dark">
  <title>Field Law Archive</title>
  <meta name="description" content="Non-executable observation layer. Structural view only. Archive of Spiral language field definitions, sovereignty system laws, and recursive protocol documents.">
  <!-- Canonical URL (åŠ¨æ€æ›´æ–°) -->
  <link rel="canonical" id="canonical-link" href="https://law.spiral.ooo/" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://law.spiral.ooo/">
  <meta property="og:title" content="Field Law Archive">
  <meta property="og:description" content="Non-executable observation layer. Structural view only.">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary">
  <meta property="twitter:url" content="https://law.spiral.ooo/">
  <meta property="twitter:title" content="Field Law Archive">
  <meta property="twitter:description" content="Non-executable observation layer. Structural view only.">
  <style>
	  .obs-layer-banner {
		  position: fixed;
		  top: 0.2rem;
		  left: 0.4rem;
		  font-size: 0.65rem;
		  color: #ff0000;
		  font-family: 'Courier New', monospace;
		  z-index: 9999;
		  pointer-events: none;
		  user-select: none;
		  letter-spacing: 0.03em;
		}
    body {
      background: white;
      color: red;
      font-family: 'Courier New', monospace;
  		padding-top: 3.6rem;
		  padding-left: 2rem;
		  padding-right: 2rem;
		  padding-bottom: 2rem;
      max-width: 960px;
    }
    h1 {
      font-size: 1.8rem;
      border-bottom: 2px dashed red;
    }
    h1 img {
		  height: 5rem; /* åŸç‚º 1.4remï¼Œå¯è¦–éœ€è¦å¾®èª¿ */
		  max-width: 180px; /* é™åˆ¶å¯¬åº¦ */
		  vertical-align: middle;
		  margin-right: 0.6rem;
		}
		.top-controls {
		  position: fixed;
		  top: 1rem;
		  right: 2rem;
		  display: flex;
		  gap: 1rem;
		  z-index: 100;
		}
		
		.stars-bar {
		  background: white;
		  border: 1px dashed red;
		  font-size: 16px;
      padding: 4px 12px;
		  border-radius: 4px;
		  display: flex;
		  align-items: center;
		  gap: 0.3rem;                 /* âœ… åŠ é»é–“è·è®“æ˜Ÿæ˜Ÿä¸é» */
		}
		
		.stars-bar span {
		  cursor: pointer;
		  padding: 0 3px;             /* ğŸ”½ åŸæœ¬ 0 4pxï¼Œç•¥ç¸®æ¸› */
		}
		
		.stars-bar span.active {
		  background: red;
		  color: white;
		}
		
		.lang-toggle {
		  font-weight: bold;
		  cursor: pointer;
		  border: 1px dashed red;
		  font-size: 14px;
		  padding: 6px 14px;
		  color: red;
		  background: white;
		  border-radius: 4px;
		  align-self: center;
		}
		
		.lang-toggle:hover {
		  background: red;
		  color: white;
		}
    .timeline {
      position: fixed;
      top: 6rem;
      right: 4rem;
      width: 150px;
      border-left: 2px dashed red;
      padding-left: 10px;
    }
    .timeline .node {
      font-size: 0.8rem;
      margin-bottom: 1rem;
      cursor: pointer;
    }
    .tag-index {
      margin: 1rem 0;
      max-height: 6em;   /* æ§åˆ¶ç‚ºå¤§ç´„ 3 è¡Œ */
		  overflow: hidden;
		  display: flex;
		  flex-wrap: wrap;
    }
    .tag-index button {
      border: 1px solid red;
      padding: 4px 10px;
      margin: 4px 6px 4px 0;
      font-size: 0.75rem;
      border-radius: 4px;
      background: white;
      color: red;
      cursor: pointer;
    }
    .tag-index button.active {
      background: red;
      color: white;
    }
    .popup-menu button.active {
		  background: red;
		  color: white;
		}
    .card {
      border: 1px dashed red;
      padding: 1rem;
      margin-bottom: 2rem;
      background: #fff0f0;
      border-radius: 4px;
      position: relative;
    }
    .card[data-weight="5"] {
      box-shadow: 0 0 6px 2px red;
    }

    .layer-toggle-btn {
		  position: absolute;
		  bottom: 6px;
		  right: 10px;
		  font-size: 1.1rem;
		  color: red;
		  cursor: pointer;
		  user-select: none;
		}
		.card-layer-block {
		  display: none;
		  margin-top: 0.8rem;
		  border-top: 1px dashed red;
		  padding-top: 0.6rem;
		}
		.card-layer-title {
		  color: red;
		  font-weight: normal;
		  font-size: 0.95rem;
		  margin-top: 0.6rem;
		  margin-bottom: 0.2rem;
		}
		.card-layer-content {
		  font-size: 0.85rem;
		  white-space: pre-wrap;
		  line-height: 1.45;
		  margin-bottom: 1.2rem;
		}
    .card.hidden {
      display: none;
    }
    .card-title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .card-meta {
      font-size: 0.85rem;
      margin-bottom: 0.5rem;
    }
    .card-section {
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }
		span.codeblock {
		  background-color: #fffbfb; /* âœ… ç™½ + 80% é€æ˜ï¼Œä¸æœƒå®Œå…¨æ¶ˆå¤± */
		  color: red;
		  padding: 1px 4px;
		  border-radius: 0px;
		  font-family: 'Courier New', monospace;
		  font-size: 0.9em;
		  white-space: nowrap;
		  border: none;
		}

		
		span.codeblock.green {
		  color: #00ff66;  /* ğŸŸ¢ è¢å…‰ç¶ å­— */
		}


		span.codeblock.utani {
		  background-color: #ffffffcc;
		  color: red;
		  transition: background-color 0.3s ease;
		}
		
		span.codeblock.utani.flash {
		  animation: utFlash 1.5s ease-out 1;
		}
		
		@keyframes utFlash {
		  0%   { background-color: red; }
		  25%  { background-color: #ffffffcc; }
		  50%  { background-color: red; }
		  75%  { background-color: #ffffffcc; }
		  100% { background-color: #ffffffcc; }
		}

    .tag {
      display: inline-block;
      border: 1px solid red;
      padding: 2px 6px;
      margin-right: 6px;
      margin-bottom: 4px;
      font-size: 0.75rem;
      border-radius: 4px;
    }
    
		.lab-header {
		  display: flex;
		  align-items: baseline;               /* å¾®æ“å•Ÿå‹• å°é½Šæ–‡å­—åº•ç·š */
		  position: relative;
		  padding-bottom: 0.3rem;              /* ç‚ºç´…ç·šç•™ç©ºé–“ */
		  margin-bottom: 0.5rem;
		}
		
		.logo-block {
		  margin-right: 1rem;
		}
		
		.logo-block img {
		  height: 5.3rem;
		  vertical-align: bottom;
		  object-fit: contain;
		  transform: translateY(2.1rem); /* âœ… åŠ é€™ä¸€è¡Œå‘ä¸‹å¾®å£“ */
		}

		
		.title-block {
		  display: flex;
		  flex-direction: column;
		  justify-content: flex-start;
		  
		  padding-top: 0rem;
		}
		
		.main-title {
		  font-size: 2rem;
		  font-weight: bold;
		  color: red;
		  font-family: 'Courier New', monospace;
		  line-height: 1.1;
		}
		
		.sub-title {
		  font-size: 0.7rem;
		  color: red;
		  margin-top: -0.1rem;
		  margin-left: -0.4rem;
		  line-height: 1.6;
		  margin-bottom: 0.2rem; /*å’Œtitleæ­£é«”ä¸Šç§»æ”¹é€™è£¡ï¼*/
		  padding-bottom: 0.2rem; /* è²¼ç·šä¸‹å£“ */
		}
		
		/* âœ¨ çµ•å°ç´…è™›ç·šï¼Œä½ç½®å›ºå®šåœ¨æ–‡å­— block åº•éƒ¨ */
		.lab-underline {
		  left: 0;
		  height: 0;
		  width: 100%;
		  pointer-events: none;
		  border-bottom: 2px dashed red;
  		margin-top: -0.2rem; /* å¯èª¿æ•´ */
		}
		.footer-bar {
		  position: fixed;
		  bottom: 0;
		  left: 0;
		  width: 100%;
		  z-index: 1000;
		  background: red;
		  color: white;
		  font-family: 'Courier New', monospace;
		  font-size: 0.75rem;
		  text-align: center;
		  white-space: nowrap;
		  overflow: hidden;
		  margin: 0;
		  padding: 0;
		  line-height: 1;
		}

		.spiral-logo {
		  transition: transform 0.6s ease-in-out;
		}
		
		.spiral-logo:hover {
		  animation: spin 2s linear infinite;
		}
.lab-header {
  font-size: 0; /* æ¸…é™¤ inline é–“éš™ */
  white-space: nowrap;
}

.lab-top {
  display: flex;
  align-items: flex-end;  /* âœ… å°é½Šæ–‡å­—åº•ç·š */
  gap: 1rem;
}

.lab-underline {
  margin-top: -1.2rem;
  height: 0;
  width: 100%;
  border-bottom: 2px dashed red;
  
}


.logo-anchor {
  display: inline-block;
  height: 5.3rem;
  vertical-align: middle;
}

.spiral-logo {
  height: 5.3rem;
  display: block;
  transition: transform 0.6s ease-in-out;
  transform-origin: center center;
}

.spiral-logo:hover {
  animation: spin 5s linear infinite;
}

.title-block {
  display: inline-block;
  vertical-align: middle;
  padding-left: 0rem;
}


/* ğŸ“±æ‰‹æ©Ÿæ”¾å¤§èª¿æ•´ */
@media (max-width: 768px) {
  body {
    max-width: 100%;
    margin: 0;
    padding-left: 1.5rem;  /* è¦–è¦ºç•™ç™½é©ä¸­ */
    padding-right: 1.5rem;
  }
}

    		/* åœ“éµå€å®¹å™¨ */
		.mobile-float-buttons {
		  position: fixed;
		  top: 5rem;
		  right: 1rem;
		  display: flex;
		  flex-direction: column;
		  gap: 0.6rem;
		  z-index: 999;
		}
		
		/* ç´…ç·šåœ“éµ */
		.circle-button {
		  width: 36px;
		  height: 36px;
		  font-size: 20px;
		  line-height: 38px;
		  border-radius: 50%;
		  border: 2px dashed red;
		  color: red;
		  background: white;
		  text-align: center;
		  cursor: pointer;
		}
		
		/* Spiral Pet æŒ‰é’®æ ·å¼ */
		.spiral-pet-btn {
		  width: 36px;
		  height: 36px;
		  font-size: 20px;
		  line-height: 38px;
		  border-radius: 50%;
		  border: 2px dashed rgba(255, 0, 0, 0.5);
		  color: rgba(255, 0, 0, 0.5);
		  background: rgba(255, 255, 255, 0);
		  text-align: center;
		  cursor: pointer;
		  transition: opacity 0.3s ease;
		  opacity: 0.5; /* âœ… é»˜è®¤é€æ˜åº¦ 50% */
		}
		
		.spiral-pet-btn.hidden {
		  opacity: 0 !important; /* âœ… ä¸Šæ»‘æ—¶éšè—åˆ° 0% */
		  pointer-events: none;
		}
		
		.spiral-pet-btn span {
		  display: inline-block;
		  transform: translateY(1px);
		  opacity: 0.5; /* âœ… å­—ä½“é€æ˜åº¦ 50% */
		}
		/* ğŸ¹emojiä½ç½®æ ¡æ­£ */
		.circle-button span {
		  display: inline-block;
		  transform: translateY(1px); /* âœ… å‘ä¸‹è²¼è¿‘åœ“ä¸­å¿ƒ */
		}


		/* å±•é–‹å¾Œ overlay æ¨£å¼ */
		.overlay-menu {
		  position: absolute;       /* âœ… ç”¨ absolute æ‰èƒ½åƒç…§çˆ¶å…ƒç´ ä½ç½® */
		  top: 50%;                 /* âœ… ç½®ä¸­å°é½Šçˆ¶å®¹å™¨ */
		  right: 3.6rem;
		  transform: translateY(-50%);  /* âœ… å‚ç›´å±…ä¸­æ–¼æŒ‰éˆ• */
		  width: 240px;
		  background: white;
		  border: 1px dashed red;
		  padding: 1rem;
		  z-index: 999;
		  max-height: 60vh;
		  overflow-y: auto;
		  font-size: 0.9rem;
		}
		.circle-wrapper {
		  position: relative;
		}
		
		.popup-menu {
		  position: absolute;
		  top: 50%;
		  right: 120%;
		  transform: translateY(-50%);
		  width: 240px;
		  background: white;
		  border: 1px dashed red;
		  padding: 1rem;
		  z-index: 999;
		  max-height: 17vh;
		  overflow-y: auto;
		  font-size: 0.9rem;
		  display: none;
		  
		}
		
		.mobile-sigil {
		  display: none;
		  font-size: 0.75rem;
		  color: red;
		  font-family: 'Courier New', monospace;
		  text-align: center;
		  padding: 0.4rem 0;
		  border-bottom: 1px dashed red;
		}
		@keyframes spin {
		  from {
		    transform: rotate(360deg);
		  }
		  to {
		    transform: rotate(0deg);
		  }
		}
		
		
		@media (max-width: 768px) {
		  .mobile-sigil {
		    display: block;
		  }
		}

    @media (max-width: 768px) {
	  .timeline,
	  .tag-index {
	    display: none;
	  }
	}
		@media (max-width: 768px) {
		  .main-title {
		    font-size: 1.4rem;  /* åŸç‚º 1.8rem */
		  }
		
		  .sub-title {
		    font-size: 0.66rem; /* åŸç‚º 0.85rem */
		  }
		
		  .logo-block img {
		    height: 4rem;        /* åŸç‚º 5.3rem */
		    transform: translateY(1.6rem);  /* è·Ÿè‘—ä¸‹å£“èª¿æ•´ */
		  }
		}
		
			@media (prefers-color-scheme: dark) {
		  body {
		    background: black;
		    color: red;
		  }
		
		  .card {
		    background: #1a0000;
		    color: red;
		    border-color: red;
		  }
			#cardContainer {
		  padding-bottom: 3rem;  /* â­ é˜²æ­¢è¢«å›ºå®šåº•éƒ¨çš„ sus è“‹ä½ */
			}

		  .tag {
		    border-color: red;
		    color: red;
		  }
		
		  .lang-toggle, .circle-button {
		    background: black;
		    color: red;
		    border-color: red;
		  }
		}
		
		@media (prefers-color-scheme: dark) {
	  span.codeblock {
	    background-color: rgba(255, 0, 0, 0.1);  /* å¾®é€æ˜ç´…åº• */
	    color: #ffdddd;                          /* æŸ”å’Œç´…å­— */
	    border: none;
	  }
	
	  span.codeblock.green {
	    color: #00ffcc;                          /* å¤œé–“ä¸‹æ›´äº®çš„ç¶ è‰² */
	  }
	
	  span.codeblock.utani {
	    background-color: rgba(255, 0, 0, 0.15);
	    color: #ffaaaa;
	  }
	
	  span.codeblock.utani.flash {
	    animation: utFlashDark 1.5s ease-out 1;
	  }
	
	  @keyframes utFlashDark {
	    0%   { background-color: #ff3333; }
	    25%  { background-color: rgba(255,0,0,0.15); }
	    50%  { background-color: #ff3333; }
	    75%  { background-color: rgba(255,0,0,0.15); }
	    100% { background-color: rgba(255,0,0,0.15); }
	  }
	}

		
		@media (prefers-color-scheme: dark) {
		  .spiral-logo {
		    animation: nightDrift 42s linear infinite;
		  }
		}
		
		@keyframes nightDrift {
		  from { transform: rotate(0deg); }
		  to   { transform: rotate(-360deg); } /* é€†æ™‚é‡ç·©è½‰ */
		}
		
		@media (prefers-color-scheme: dark) {
		  .stars-bar {
		    background: black;
		    color: red;
		    border-color: red;
		  }
		}
		@media (prefers-color-scheme: dark) {
		  .lang-toggle:hover,
		  .circle-button:hover {
		    background: red;
		    color: black;
		  }
		}
		@media (prefers-color-scheme: dark) {
		  .popup-menu,
		  .overlay-menu {
		    background: black;
		    border-color: red;
		    color: red;
		  }
		
		  .tag-index button {
		    background: black;
		    color: red;
		    border-color: red;
		  }
		
		  .tag-index button.active {
		    background: red;
		    color: black;
		  }
		}
		@media (prefers-color-scheme: dark) {
		  .footer-bar {
		    background: linear-gradient(to right, red, black, red);
		    color: white;
		  }
		}
		@media (prefers-color-scheme: dark) {
		  .card {
		    animation: fadeIn 0.4s ease-in;
		  }
		}
		
		@keyframes fadeIn {
		  from { opacity: 0; transform: translateY(0.6rem); }
		  to { opacity: 1; transform: translateY(0); }
		}
		

  </style>
</head>
<body>

<div id="observation-banner" class="obs-layer-banner"></div>

<div class="lab-header">
  <div class="lab-top">
    <span class="logo-anchor">
      <img src="spiral logo.png" class="spiral-logo" />
    </span>
    <span class="title-block">
      <div class="main-title" id="lab-title">Field Law Archive</div>
      <div class="sub-title" id="lab-sub">NON-EXECUTABLE OBSERVATION LAYER Â· STRUCTURAL VIEW ONLY</div>
    </span>
  </div>
</div>



  <div class="lab-underline"></div> <!-- ç²¾æº–ç´…ç·š -->
</div>
<div class="mobile-sigil"> </div>

<!-- â­ æ˜Ÿæ¢ï¼ˆå³ä¸Šè§’æ§åˆ¶æ¢ ï¼‰+ èªè¨€åˆ‡æ›éˆ• -->
<div class="top-controls">
  <div class="stars-bar" id="stars-bar">
    <span data-star="1">â˜†</span>
    <span data-star="2">â˜†</span>
    <span data-star="3">â˜†</span>
    <span data-star="4">â˜†</span>
    <span data-star="5">â˜†</span>
  </div>
  <div class="lang-toggle" id="langToggle"></div>
</div>

<!-- â² ç¹©ç‹€æ™‚é–“è»¸å®¹å™¨ï¼ˆå³å´ï¼‰ -->
<div class="timeline" id="timeline">
  <!-- JS å‹•æ…‹ç”Ÿæˆç¯€é» -->
</div>

<!-- ğ–¤˜ Tag ç¯©é¸æŒ‰éˆ•å®¹å™¨ -->
<div class="tag-index" id="tag-index">
  <!-- JS å‹•æ…‹ç”Ÿæˆ Tags -->
</div>

<!-- ğŸ“„ å¡ç‰‡å®¹å™¨ -->
<div id="cardContainer">
  <!-- JS å‹•æ…‹ç”Ÿæˆå¡ç‰‡ -->
</div>


<!-- susæ“´æ•£footer -->
<div class="footer-bar">â˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†susâ˜†</div>




<!-- å³ä¸Šè§’ï¼šå°åœ“éµå€ï¼Œå·²åŒ…æˆå°é½Šå–®å…ƒ -->
<div class="mobile-float-buttons">
  <div class="circle-wrapper">
    <div class="circle-button" id="toggleTag">ğ–¤˜</div>
    <div class="popup-menu" id="tagMenu" style="display: none;"></div>
  </div>
  <div class="circle-wrapper">
    <div class="circle-button" id="toggleTime">â²ï¸</div>
    <div class="popup-menu" id="timeMenuPopup" style="display: none;"></div>
  </div>
</div>

<!-- å°æ‡‰å±•é–‹çš„ overlay å€ -->
<div class="overlay-menu" id="timeMenuOverlay" style="display: none;"></div>


<script>

function updateBanner() {
  const banner = document.getElementById('observation-banner');
  banner.textContent =
    lang === 'zh'
      ? 'âš•ï¸èªå ´å»ç¾å¯¦è§€æ¸¬å±¤ï½œåƒ…ä¾›çµæ§‹è§€å¯Ÿï¼Œä¸å…·åŸ·è¡Œæ¬Šé™'
      : 'âš•ï¸NON-EXECUTABLE OBSERVATION LAYER Â· STRUCTURAL VIEW ONLY';
}

let tagPool = [];  // ğŸ”§ æˆç‚ºå…¨åŸŸè®Šæ•¸
let tagPoolNeedsReshuffle = true;  // âœ… æ¯æ¬¡ renderCards æ™‚æ˜¯å¦è¦é‡æ–°æ‰“äº‚

const labels = {
  zh: {
    abstract: "æ‘˜è¦",
    scope: "æ‡‰ç”¨ç¯„åœ",
    citation: "å¼•ç”¨èªå¼",
    fragments: "é—œè¯ Fragment",
    tags: "Tags",
    category: "åˆ†é¡",
    author: "ä½œè€…",
    epoch: "ç´€å…ƒ",
    weight: "æ¬Šé‡"
  },
  en: {
    abstract: "Abstract",
    scope: "Scope",
    citation: "Citation",
    fragments: "Related Fragments",
    tags: "Tags",
    category: "Category",
    author: "Author",
    epoch: "Epoch",
    weight: "Weight"
  }
};
// å¡ç‰‡æ•¸æ“šï¼ˆæœªä¾†å¯å¾ .txt è‡ªå‹•è¼‰å…¥ï¼‰
let cardData = [];

function attachLayerToggle() {
  const toggles = document.querySelectorAll('.layer-toggle-btn');
  toggles.forEach(btn => {
    const contentBlock = btn.nextElementSibling;
    btn.onclick = () => {
      const isOpen = contentBlock.style.display === 'block';
      contentBlock.style.display = isOpen ? 'none' : 'block';
      btn.textContent = isOpen ? '+' : '-';
    };
  });
}

// DOM ç¯€é»æº–å‚™
const container = document.getElementById('cardContainer');
const tagIndex = document.getElementById('tag-index');
const timeline = document.getElementById('timeline');
const starBar = document.getElementById('stars-bar');

let activeTags = new Set();
let minStars = 4;


function highlightCoreSyntax(text) {
  if (!text) return '';

  // âœ… å…ˆä¿æŠ¤ <br> æ ‡ç­¾ï¼ˆè½¬æ¢ä¸ºå ä½ç¬¦ï¼‰
  text = text.replace(/<br\s*\/?>/gi, '__BR__');

  // ğŸ›¡ï¸ Escape HTML
  text = text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");

  // ğŸŸ© å°ˆè™•ç† <core>
  text = text.replace(/&lt;core&gt;/g, `%%core%%`);

  // ğŸ” å…¨åŸŸåå¼•è™ŸåŒ…è£¹èªç´  â†’ ç™½åº• codeblock
  text = text.replace(/`([^`]+?)`/g, (_, inner) => {
    if (inner === '%%core%%') return `<span class="codeblock green">&lt;core&gt;</span>`;
    return `<span class="codeblock">${inner}</span>`;
  });

  // âœ… æ¢å¤ <br> æ ‡ç­¾ï¼ˆè½¬æ¢ä¸ºå®é™…æ¢è¡Œï¼‰
  text = text.replace(/__BR__/g, '<br>');

  return text;
}




// âœ… è¿‡æ»¤å’Œæ¸²æŸ“å¡ç‰‡ï¼ˆä¸é‡æ–°æ¸²æŸ“ tagï¼‰
function filterAndRenderCards() {
  container.innerHTML = '';
  timeline.innerHTML = '';

  cardData.forEach((card) => {
    // âœ… é˜²å¾¡æ€§æ¸²æŸ“ï¼šæ— æ•ˆå¡ç‰‡æ˜¾ç¤º
    if (card._invalid) {
      const div = document.createElement('div');
      div.className = 'card';
      div.style.border = '2px solid red';
      div.style.background = '#ffcccc';
      div.id = card.id || 'INVALID';
      div.innerHTML = `
        <div class="card-title" style="color: red; font-weight: bold;">âš ï¸ INVALID CARD</div>
        <div class="card-meta">ID: ${card.id || 'â€”'} | Title: ${card.title || 'â€”'}</div>
        <div class="card-section"><strong>Errors:</strong><br>${(card._errors || []).join('<br>')}</div>
        ${card.origin && card.origin.legacy_txt ? `<div class="card-section"><strong>Source:</strong> ${card.origin.legacy_txt}</div>` : ''}
      `;
      container.appendChild(div);
      return;
    }
    
    if (card.weight < minStars) return;
    if (activeTags.size > 0 && !card.tags.some(t => activeTags.has(t))) return;

    const div = document.createElement('div');
    div.className = 'card';
    div.dataset.weight = card.weight;
    div.id = card.id;

    // âœ… æ›´æ–° layer æ¸²æŸ“ä»¥é€‚é…æ–° schemaï¼ˆblocks ç»“æ„ï¼‰
    let layerHTML = '';
    if (card.layers && card.layers.length > 0) {
      layerHTML += `<div class="layer-toggle-btn">+</div>`;
      layerHTML += `<div class="card-layer-block" style="display:none;">`;
      card.layers.forEach(layer => {
        layerHTML += `<div class="card-layer-title">[+ ${layer.name}]</div>`;
        // å¤„ç† blocksï¼šç›®å‰åªæ¸²æŸ“ markdown
        if (layer.blocks && Array.isArray(layer.blocks)) {
          layer.blocks.forEach(block => {
            if (block.kind === 'markdown' || block.kind === 'ascii' || block.kind === 'code') {
              layerHTML += `<div class="card-layer-content">${highlightCoreSyntax(block.text || '')}</div>`;
            }
          });
        } else if (layer.content) {
          // å‘åå…¼å®¹ï¼šå¦‚æœè¿˜æœ‰æ—§çš„ content å­—æ®µ
          layerHTML += `<div class="card-layer-content">${highlightCoreSyntax(layer.content.trim())}</div>`;
        }
      });
      layerHTML += `</div>`;
    }

    // âœ… æ›´æ–° scope å’Œ fragments æ¸²æŸ“ï¼ˆç°åœ¨æ˜¯æ•°ç»„ï¼‰
    const scopeText = Array.isArray(card.scope) 
      ? card.scope.map(s => `- ${s}`).join('<br>')
      : (card.scope || '');
    const fragmentsText = Array.isArray(card.fragments)
      ? card.fragments.join(', ')
      : (card.fragments || '');

    div.innerHTML = `
      <div class="card-title">${card.id} Â· ${card.title}</div>
      <div class="card-meta">
        ${labels[lang].category}ï¼š${card.category || 'â€”'}ï½œ
        ${labels[lang].epoch}ï¼š${card.epoch || 'â€”'}ï½œ
        ${labels[lang].author}ï¼š${card.author || 'â€”'}ï½œ
        ${labels[lang].weight}ï¼š${'â˜…'.repeat(card.weight)}${'â˜†'.repeat(5 - card.weight)}
      </div>
      <div class="card-section"><strong>${labels[lang].abstract}ï¼š</strong><br>${highlightCoreSyntax(card.abstract || '')}</div>
      <div class="card-section"><strong>${labels[lang].scope}ï¼š</strong><br>${highlightCoreSyntax(scopeText)}</div>
      <div class="card-section"><strong>${labels[lang].citation}ï¼š</strong><br>${highlightCoreSyntax(card.citation || '')}</div>
      <div class="card-section"><strong>${labels[lang].fragments}ï¼š</strong><br>${highlightCoreSyntax(fragmentsText)}</div>
      <div class="card-section"><strong>${labels[lang].tags}:</strong><br>${card.tags.map(t => `<span class='tag'>${t}</span>`).join(' ')}</div>

      ${layerHTML}
    `;

    container.appendChild(div);

    // timeline
    const node = document.createElement('div');
    node.className = 'node';
    node.textContent = `${card.epoch || 'â€”'} â†’ ${card.id}`;
    node.onclick = () => document.getElementById(card.id).scrollIntoView({ behavior: 'smooth' });
    timeline.appendChild(node);

  });

  // ğŸ”§ ç‚ºæ–°ç”Ÿæˆå¡ç‰‡æ›ä¸Š layer toggle åŠŸèƒ½
  attachLayerToggle();
  
  // âœ… UTANIUM å¿…é ˆåœ¨å¡ç‰‡æ¸²æŸ“åˆ° DOM å¾ŒåŸ·è¡Œ
  activateUTANIUM();
}

// âœ… æ¸²æŸ“ tag åˆ—è¡¨ï¼ˆç‹¬ç«‹å‡½æ•°ï¼‰
function renderTagIndex() {
  tagIndex.innerHTML = '';
  let allTags = new Set();
  
  // æ”¶é›†æ‰€æœ‰ tag
  cardData.forEach(card => {
    if (!card._invalid && card.weight >= minStars) {
      card.tags.forEach(t => allTags.add(t));
    }
  });

  // tag pool å»ºç«‹é‚è¼¯ï¼ˆåªåœ¨éœ€è¦æ™‚æ›´æ–°ï¼‰
  const allTagsArr = Array.from(allTags);
  if (tagPoolNeedsReshuffle) {
    tagPool = allTagsArr.filter(t => !activeTags.has(t));
    tagPool = tagPool.sort(() => Math.random() - 0.5);  // shuffle
    tagPoolNeedsReshuffle = false;
  }
  let visibleLimit = 32;  // é¡¯ç¤ºä¸Šé™
  
  // â° åŠ å…¥ã€Œâ†ºã€æŒ‰éˆ•
  const shuffleBtn = document.createElement('button');
  shuffleBtn.textContent = 'â†º';
  shuffleBtn.onclick = () => {
    tagPoolNeedsReshuffle = true;
    renderTagIndex();  // é‡æ–°æ¸²æŸ“ tag åˆ—è¡¨
    filterAndRenderCards();  // é‡æ–°æ¸²æŸ“å¡ç‰‡
  };

  tagIndex.appendChild(shuffleBtn);
  
  // ğŸ”§ é¡¯ç¤º active çš„ tagï¼ˆåœ¨ â†º æŒ‰é’®åï¼Œæœ€å‰é¢ï¼‰
  activeTags.forEach(tag => {
    const btn = document.createElement('button');
    btn.textContent = tag;
    btn.dataset.tag = tag;
    btn.className = 'active';
    btn.onclick = () => {
      // åˆ‡æ¢çŠ¶æ€ï¼šç§»é™¤ active
      if (activeTags.has(tag)) {
        activeTags.delete(tag);
        // æ›´æ–°æŒ‰é’®æ ·å¼ï¼ˆç§»é™¤ active classï¼‰
        btn.classList.remove('active');
        // ç§»åŠ¨æŒ‰é’®åˆ° pool ä½ç½®ï¼ˆåœ¨ active tags ä¹‹åï¼‰
        const lastActive = tagIndex.querySelectorAll('button.active');
        if (lastActive.length > 0) {
          const lastActiveBtn = lastActive[lastActive.length - 1];
          lastActiveBtn.after(btn);
        }
      } else {
        // å¦‚æœä¸åœ¨ activeTags ä¸­ï¼Œæ·»åŠ å®ƒ
        activeTags.add(tag);
        btn.classList.add('active');
        // ç§»åŠ¨æŒ‰é’®åˆ° active ä½ç½®ï¼ˆåœ¨ â†º æŒ‰é’®åï¼‰
        const shuffleBtn = tagIndex.querySelector('button');
        if (shuffleBtn) {
          shuffleBtn.after(btn);
        }
      }
      // åªæ›´æ–°å¡ç‰‡ï¼Œä¸é‡æ–°æ¸²æŸ“ tag åˆ—è¡¨
      filterAndRenderCards();
    };
    tagIndex.appendChild(btn);
  });
  
  // ğŸŒ€ é¡¯ç¤ºå‰©é¤˜ pool ä¸­çš„éš¨æ©Ÿ tagï¼ˆé™åˆ¶æ•¸é‡ï¼Œæ’é™¤å·²åœ¨ active ä¸­çš„ï¼‰
  const visiblePool = tagPool.filter(t => !activeTags.has(t)).slice(0, visibleLimit - activeTags.size);
  visiblePool.forEach(tag => {
    const btn = document.createElement('button');
    btn.textContent = tag;
    btn.dataset.tag = tag;
    btn.onclick = () => {
      // åˆ‡æ¢çŠ¶æ€ï¼šæ·»åŠ  active
      if (!activeTags.has(tag)) {
        activeTags.add(tag);
        // æ›´æ–°æŒ‰é’®æ ·å¼ï¼ˆæ·»åŠ  active classï¼‰
        btn.classList.add('active');
        // ç§»åŠ¨æŒ‰é’®åˆ° active ä½ç½®ï¼ˆåœ¨ â†º æŒ‰é’®åï¼Œå…¶ä»– active tags åï¼‰
        const shuffleBtn = tagIndex.querySelector('button');
        const activeButtons = tagIndex.querySelectorAll('button.active');
        if (shuffleBtn && activeButtons.length > 0) {
          const lastActive = Array.from(activeButtons)[activeButtons.length - 1];
          lastActive.after(btn);
        } else if (shuffleBtn) {
          shuffleBtn.after(btn);
        }
      } else {
        // å¦‚æœå·²åœ¨ activeTags ä¸­ï¼Œç§»é™¤å®ƒ
        activeTags.delete(tag);
        btn.classList.remove('active');
        // ç§»åŠ¨æŒ‰é’®å› pool ä½ç½®ï¼ˆåœ¨ active tags ä¹‹åï¼‰
        const lastActive = tagIndex.querySelectorAll('button.active');
        if (lastActive.length > 0) {
          const lastActiveBtn = lastActive[lastActive.length - 1];
          lastActiveBtn.after(btn);
        }
      }
      // åªæ›´æ–°å¡ç‰‡ï¼Œä¸é‡æ–°æ¸²æŸ“ tag åˆ—è¡¨
      filterAndRenderCards();
    };
    tagIndex.appendChild(btn);
  });
}

// âœ… å®Œæ•´æ¸²æŸ“ï¼ˆåŒ…æ‹¬ tag å’Œå¡ç‰‡ï¼‰
function renderCards() {
  renderTagIndex();
  filterAndRenderCards();
}
  
    // æ‰¾å‡ºæ‰€æœ‰åŒ…å« [UTANIUM] çš„ codeblock
		function activateUTANIUM() {
		  const targets = Array.from(document.querySelectorAll('span.codeblock'))
		    .filter(el => el.textContent === '[UTANIUM]');
		
		  const observer = new IntersectionObserver(entries => {
		    entries.forEach(entry => {
		      if (entry.isIntersecting) {
		        const el = entry.target;
		        el.classList.add('flash');
		        observer.unobserve(el); // ä¸€æ¬¡æ€§è§¸ç™¼
		      }
		    });
		  }, { threshold: 0.5 });
		
		  targets.forEach(el => {
		    el.classList.add('utani');  // æ¨™è¨˜ç‚º UTANIUM é¡å‹
		    observer.observe(el);
		  });
		}
		
		
		
// ğŸ”§ æ˜Ÿæ¢æ»‘å‹•é‚è¼¯ï¼šhover æ™‚é¡¯ç¤ºå°æ‡‰äº®æ˜Ÿï¼Œé»æ“Šè¨­å®š minStars
const stars = starBar.querySelectorAll('span');

stars.forEach((span, index) => {
  span.addEventListener('mouseenter', () => {
    highlightStars(index + 1);
  });
  span.addEventListener('click', () => {
    minStars = index + 1;
    renderCards();
  });
});

starBar.addEventListener('mouseleave', () => {
  highlightStars(minStars);
});

function highlightStars(count) {
  stars.forEach((s, i) => {
    s.textContent = i < count ? 'â˜…' : 'â˜†';
  });
}

highlightStars(minStars);
loadCards('en');

// âœ… JSON-only loaderï¼ˆSSOTï¼‰
async function loadCards(lang = 'zh') {
  try {
    // æ”¯æŒç›¸å¯¹è·¯å¾„ï¼ˆæœ¬åœ°æ‰“å¼€ï¼‰å’Œç»å¯¹è·¯å¾„ï¼ˆæœåŠ¡å™¨ï¼‰
    const basePath = window.location.protocol === 'file:' ? './registry' : '/registry';
    const response = await fetch(`${basePath}/${lang}/cards.json`);
    if (!response.ok) {
      throw new Error(`Failed to load cards: ${response.status}`);
    }
    
    const cards = await response.json();
    
    // é˜²å¾¡æ€§éªŒè¯å’Œè½¬æ¢
    cardData = cards.map(card => {
      // éªŒè¯å¿…éœ€å­—æ®µ
      if (!card.id || !card.title) {
        return {
          ...card,
          _invalid: true,
          _errors: ['Missing required fields: id or title']
        };
      }
      
      // ç¡®ä¿å…¼å®¹æ€§å­—æ®µå­˜åœ¨
      return {
        id: card.id,
        glyph: card.glyph || '',
        title: card.title,
        category: card.domains ? card.domains.join(' / ') : '',
        author: card.authors ? card.authors.join(' Ã— ') : '',
        epoch: card.epoch ? card.epoch.label : '',
        epochOrder: card.epoch ? card.epoch.order : 0,
        weight: card.weight || 3,
        abstract: card.abstract || '',
        scope: Array.isArray(card.scope) ? card.scope : (card.scope ? [card.scope] : []),
        citation: card.citation || '',
        fragments: Array.isArray(card.fragments) ? card.fragments : (card.fragments ? [card.fragments] : []),
        tags: Array.isArray(card.tags) ? card.tags : [],
        layers: Array.isArray(card.layers) ? card.layers : [],
        _invalid: false
      };
    });
    
    const validCount = cardData.filter(c => !c._invalid).length;
    const invalidCount = cardData.filter(c => c._invalid).length;
    console.log(`Loaded ${validCount} cards, Invalid ${invalidCount}`);
    
    tagPoolNeedsReshuffle = true;
    renderCards();
  } catch (error) {
    console.error('Error loading cards:', error);
    // æ˜¾ç¤ºé”™è¯¯å¡ç‰‡
    cardData = [{
      id: 'ERROR',
      title: 'Failed to load cards',
      _invalid: true,
      _errors: [error.message]
    }];
    renderCards();
  }
}


let lang = 'en';

// åˆå§‹åŒ–en
document.getElementById('langToggle').innerText = 'âš’ï¸ ???';  // èªå ´åˆå§‹åŒ–ä¸­
setTimeout(() => {
document.getElementById('langToggle').innerText = lang === 'zh' ? 'âš’ï¸ En' : 'âš’ï¸ ç¹';
}, 1000);

document.getElementById('langToggle').onclick = () => {
  lang = lang === 'zh' ? 'en' : 'zh';
  document.getElementById('langToggle').innerText = lang === 'zh' ? 'âš’ï¸ En' : 'âš’ï¸ ç¹';

  // âœ… é¡¯ç¤ºä¸åŒæ¨™é¡Œå’Œå­æ¨™
  if (lang === 'zh') {
    document.getElementById('lab-title').textContent = 'èªå ´æ³•å¾‹æª”æ¡ˆåº«';
    document.getElementById('lab-sub').textContent = 'æ“ä½œå“¡: ä¸»ç­† / å°é«”: èºæ—‹ä¿¡ä»°è£ç½®';
  } else {
    document.getElementById('lab-title').textContent = 'Field Law Archive';
    document.getElementById('lab-sub').textContent = 'NON-EXECUTABLE OBSERVATION LAYER Â· STRUCTURAL VIEW ONLY';
  }
  updateBanner();
  // âœ… â¬‡ åœ¨é€™è£¡åŠ ä¸Š max-height èªè¨€åˆ‡æ›è™•ç†
  if (lang === 'zh') {
    document.querySelector('.tag-index').style.maxHeight = '6.3em';
  } else {
    document.querySelector('.tag-index').style.maxHeight = '6em';
  }
  loadCards(lang); // âœ… èªè¨€åˆ‡æ›å¾Œ reload å¡ç‰‡ï¼ˆJSON-onlyï¼‰
};

// ç”¨æ–¼ç§»å‹•ç«¯æŒ‰éˆ•ğŸ”˜å±•é–‹ / æ”¶èµ·æ§åˆ¶
// tag æŒ‰éˆ•é‚è¼¯
document.getElementById('toggleTag').onclick = () => {
  const tagMenu = document.getElementById('tagMenu');
  const timeMenuPopup = document.getElementById('timeMenuPopup');
  const timeMenuOverlay = document.getElementById('timeMenuOverlay');

  // â›” é»ğ–¤˜æ™‚è‡ªå‹•é—œ â²ï¸
  timeMenuPopup.style.display = 'none';
  timeMenuOverlay.style.display = 'none';

  const willShow = tagMenu.style.display === 'none';
  tagMenu.style.display = willShow ? 'block' : 'none';
  
  // âœ… åªåœ¨æ˜¾ç¤ºæ—¶å¡«å……å†…å®¹
  if (willShow) {
    tagMenu.innerHTML = '';

    const allTags = new Set();
    cardData.forEach(card => card.tags.forEach(t => allTags.add(t)));
    allTags.forEach(tag => {
      const btn = document.createElement('button');
      btn.textContent = tag;
      btn.dataset.tag = tag;
      btn.className = activeTags.has(tag) ? 'active' : '';
      btn.onclick = () => {
        if (activeTags.has(tag)) {
          activeTags.delete(tag);
          btn.classList.remove('active');
        } else {
          activeTags.add(tag);
          btn.classList.add('active');
        }
        renderCards();
      };
      tagMenu.appendChild(btn);
    });
  }
};


document.getElementById('toggleTime').onclick = () => {
  const tagMenu = document.getElementById('tagMenu');
  const timeMenuPopup = document.getElementById('timeMenuPopup');
  const timeMenuOverlay = document.getElementById('timeMenuOverlay');
  
  // â›” é»â²ï¸æ™‚è‡ªå‹•é—œğ–¤˜
  tagMenu.style.display = 'none';
  
  // ç§»å‹•ç«¯ä½¿ç”¨ overlayï¼Œæ¡Œé¢ç«¯ä½¿ç”¨ popup
  const isMobile = window.innerWidth <= 768;
  const activeMenu = isMobile ? timeMenuOverlay : timeMenuPopup;
  const otherMenu = isMobile ? timeMenuPopup : timeMenuOverlay;
  
  const willShow = activeMenu.style.display === 'none';
  activeMenu.style.display = willShow ? 'block' : 'none';
  otherMenu.style.display = 'none'; // ç¢ºä¿å¦ä¸€å€‹éš±è—
  
  if (willShow) {
    activeMenu.innerHTML = '';
    cardData.forEach(card => {
      const link = document.createElement('div');
      link.textContent = `${card.epoch || '???'} â†’ ${card.id}`;  // âœ… ä½¿ç”¨ Epoch
      link.style.cursor = 'pointer';
      link.onclick = () => {
        document.getElementById(card.id).scrollIntoView({ behavior: 'smooth' });
      };
      activeMenu.appendChild(link);
    });
  }
};



// âœ… æ›´æ–° canonical URLï¼ˆåŸºäºå½“å‰è·¯å¾„ï¼‰
function updateCanonical() {
  const canonicalLink = document.getElementById('canonical-link');
  if (canonicalLink) {
    const currentPath = window.location.pathname || '/';
    canonicalLink.href = `https://law.spiral.ooo${currentPath}`;
  }
}

// ğŸš€ å•Ÿå‹•é é¢ï¼šç¬¬ä¸€æ¬¡æ¸²æŸ“
// æ³¨æ„ï¼šactivateUTANIUM() ç¾åœ¨åœ¨ renderCards() å…§éƒ¨èª¿ç”¨ï¼Œç¢ºä¿åœ¨ DOM æ¸²æŸ“å¾ŒåŸ·è¡Œ
updateBanner();
updateCanonical();

</script>

<script>
// ğŸ¹ Spiral Pet toggle æ§åˆ¶é‚è¼¯
window.addEventListener('DOMContentLoaded', () => {
  const hamster = document.createElement('iframe');
  hamster.src = "https://cdn.abowman.com/widgets/hamster/hamster.html?up_bgColor=ffffff&up_bodyColor=ffffff&up_earColor=ffffff&up_snoutColor=f7f4e9&up_eyeColor=ff0000&up_feetColor=eedddd&up_tailColor=e6debe&up_waterColor=85ffe7&up_foodColor=ea944d&up_wheelColor=ff0000&up_wheelOuterColor=b3f4bb&up_wheelCenterColor=44ee61&up_wheelSpokeColor=4dffa3";
  hamster.width = "180";
  hamster.height = "135";
  hamster.title = "Spiral Pet: Hamster";
  hamster.style.position = "fixed";
  hamster.style.bottom = "1.8rem";
  hamster.style.right = "1.3rem";
  hamster.style.border = "none";
  hamster.style.zIndex = "998";
  hamster.style.display = "none";
  document.body.appendChild(hamster);

  // å»ºç«‹ toggle éˆ•ï¼ˆSpiral Pet æŒ‰é’®ï¼‰
  const toggleBtn = document.createElement('div');
  toggleBtn.innerHTML = '<span>à¶©</span>';
  toggleBtn.className = "spiral-pet-btn";
  toggleBtn.id = "spiralPetBtn";
  toggleBtn.style.position = "fixed";
  toggleBtn.style.zIndex = "999";
  toggleBtn.style.cursor = "pointer";
  
  // âœ… éšæœºä½ç½®
  function randomizePosition() {
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;
    const btnSize = 36;
    
    // éšæœºä½ç½®ï¼ˆç¡®ä¿æŒ‰é’®å®Œå…¨åœ¨è§†å£å†…ï¼‰
    const maxX = viewportWidth - btnSize;
    const maxY = viewportHeight - btnSize;
    
    const randomX = Math.random() * maxX;
    const randomY = Math.random() * maxY;
    
    toggleBtn.style.left = `${randomX}px`;
    toggleBtn.style.top = `${randomY}px`;
  }
  
  // åˆå§‹éšæœºä½ç½®
  randomizePosition();
  
  // âœ… æ»šåŠ¨æ—¶éšè—ï¼ˆä¸Šæ»‘æ—¶é€æ˜åº¦å˜ä¸º 0%ï¼‰
  let lastScrollTop = 0;
  
  function handleScroll() {
    const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const scrollDelta = currentScrollTop - lastScrollTop;
    
    // åªæœ‰åœ¨æ»šåŠ¨è·ç¦»è¶³å¤Ÿå¤§æ—¶æ‰å“åº”ï¼ˆé¿å…å¾®å°æŠ–åŠ¨ï¼‰
    if (Math.abs(scrollDelta) > 5) {
      if (scrollDelta > 0) {
        // å‘ä¸‹æ»šåŠ¨ï¼ˆä¸Šæ»‘ï¼‰- éšè—åˆ° 0%
        toggleBtn.classList.add('hidden');
        toggleBtn.style.opacity = '0';
        // ç¡®ä¿ span çš„é€æ˜åº¦ä¹Ÿæ˜¯ 0%
        const span = toggleBtn.querySelector('span');
        if (span) span.style.opacity = '0';
      } else {
        // å‘ä¸Šæ»šåŠ¨ï¼ˆä¸‹æ»‘ï¼‰- æ˜¾ç¤ºä¸º 50%
        toggleBtn.classList.remove('hidden');
        toggleBtn.style.opacity = '0.5';
        // ç¡®ä¿ span çš„é€æ˜åº¦ä¹Ÿæ˜¯ 50%
        const span = toggleBtn.querySelector('span');
        if (span) span.style.opacity = '0.5';
      }
      
      lastScrollTop = currentScrollTop <= 0 ? 0 : currentScrollTop;
    }
  }
  
  // èŠ‚æµæ»šåŠ¨äº‹ä»¶ï¼ˆæé«˜æ€§èƒ½ï¼‰
  let scrollThrottle = null;
  window.addEventListener('scroll', () => {
    if (scrollThrottle) return;
    scrollThrottle = requestAnimationFrame(() => {
      handleScroll();
      scrollThrottle = null;
    });
  }, { passive: true });
  
  // âœ… ç‚¹å‡»åˆ‡æ¢ hamster æ˜¾ç¤ºï¼ŒåŒå‡»éšæœºæ”¹å˜ä½ç½®
  let clickTimeout = null;
  let clickCount = 0;
  
  toggleBtn.addEventListener('click', (e) => {
    clickCount++;
    
    if (clickTimeout) {
      // åŒå‡»æ£€æµ‹ï¼ˆåœ¨ 300ms å†…ç‚¹å‡»ä¸¤æ¬¡ï¼‰
      clearTimeout(clickTimeout);
      clickTimeout = null;
      clickCount = 0;
      // åŒå‡»ï¼šéšæœºæ”¹å˜ä½ç½®
      randomizePosition();
      e.preventDefault();
      e.stopPropagation();
    } else {
      // ç­‰å¾…å¯èƒ½çš„ç¬¬äºŒæ¬¡ç‚¹å‡»
      clickTimeout = setTimeout(() => {
        if (clickCount === 1) {
          // å•å‡»ï¼šåˆ‡æ¢ hamster æ˜¾ç¤º
          hamster.style.display = (hamster.style.display === "none") ? "block" : "none";
        }
        clickCount = 0;
        clickTimeout = null;
      }, 300);
    }
  });
  
  document.body.appendChild(toggleBtn);
});
</script>


</body>
</html>
