# ğŸœ‚ Field Law Archive

**Site**: https://law.spiral.ooo

## æ¦‚è¿°

Field Law Archive æ˜¯ä¸€ä¸ªä» TXT æ–‡ä»¶è¿ç§»åˆ° JSON SSOTï¼ˆå•ä¸€æ•°æ®æºï¼‰çš„å·¥ç¨‹é‡æ„ã€‚è¿™æ˜¯ä¸€ä¸ªéæ‰§è¡Œæ€§è§‚å¯Ÿå±‚ï¼ˆNon-executable observation layerï¼‰ï¼Œä»…ä¾›ç»“æ„è§‚å¯Ÿä½¿ç”¨ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼š
- **JSON æ˜¯ SSOT**ï¼šæ‰€æœ‰å¡ç‰‡æ•°æ®ä»¥ JSON æ ¼å¼å­˜å‚¨
- **TXT æ˜¯ç”Ÿæˆäº§ç‰©**ï¼šTXT æ–‡ä»¶ç”±ç”Ÿæˆå™¨è‡ªåŠ¨ç”Ÿæˆï¼Œä¸åº”æ‰‹åŠ¨ç¼–è¾‘
- **å‰ç«¯ä¸å†è§£æ TXT**ï¼šå‰ç«¯ä»…è¯»å– JSON æ–‡ä»¶
- **æ— æ•ˆå¡ç‰‡å¯è§**ï¼šæ— æ•ˆå¡ç‰‡ä¼šæ˜¾ç¤ºä¸º "INVALID CARD" å ä½ç¬¦ï¼Œä¸ä¼šé™é»˜æ¶ˆå¤±

---

## æ¶æ„

### æ•°æ®æµ

```
registry/{lang}/*.txt (æºæ–‡ä»¶)
    â†“
tools/registry_build.py (ç”Ÿæˆå™¨)
    â†“
public/registry/{lang}/cards.json (SSOT)
    â†“
index.html (å‰ç«¯ï¼ŒJSON-only)
```

### ç›®å½•ç»“æ„

```
spirallab/
â”œâ”€â”€ registry/              # æº TXT æ–‡ä»¶ï¼ˆå¯ç¼–è¾‘ï¼‰
â”‚   â”œâ”€â”€ zh/
â”‚   â”‚   â”œâ”€â”€ index.txt
â”‚   â”‚   â””â”€â”€ *.txt
â”‚   â””â”€â”€ en/
â”‚       â”œâ”€â”€ index.txt
â”‚       â””â”€â”€ *.txt
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ registry_build.py  # ç”Ÿæˆå™¨
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ registry/          # ç”Ÿæˆçš„ JSONï¼ˆSSOTï¼‰
â”‚   â”‚   â”œâ”€â”€ zh/
â”‚   â”‚   â”‚   â””â”€â”€ cards.json
â”‚   â”‚   â””â”€â”€ en/
â”‚   â”‚       â””â”€â”€ cards.json
â”‚   â””â”€â”€ reports/           # éªŒè¯æŠ¥å‘Š
â”‚       â”œâ”€â”€ registry-validate.json
â”‚       â””â”€â”€ registry-validate.md
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ card-schema.md     # Schema æ–‡æ¡£
â””â”€â”€ index.html             # å‰ç«¯ï¼ˆJSON-onlyï¼‰
```

---

## ä½¿ç”¨æ–¹æ³•

### ç¼–è¾‘å¡ç‰‡

**é‡è¦**ï¼šä¸è¦ç›´æ¥ç¼–è¾‘ç”Ÿæˆçš„ JSON æ–‡ä»¶ã€‚

#### æ–¹æ³• 1ï¼šç¼–è¾‘æº TXT æ–‡ä»¶ï¼ˆæ¨èï¼‰

1. ç¼–è¾‘ `registry/{lang}/*.txt` æ–‡ä»¶
2. è¿è¡Œç”Ÿæˆå™¨ï¼š
   ```bash
   python3 tools/registry_build.py
   ```
3. ç”Ÿæˆçš„ JSON ä¼šè‡ªåŠ¨æ›´æ–°

#### æ–¹æ³• 2ï¼šç›´æ¥ç¼–è¾‘ JSONï¼ˆé«˜çº§ï¼‰

å¦‚æœç†Ÿæ‚‰ schemaï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘ `public/registry/{lang}/cards.json`ï¼Œä½†éœ€è¦ï¼š
- éµå¾ª [card-schema.md](docs/card-schema.md) è§„èŒƒ
- æ‰‹åŠ¨è¿è¡ŒéªŒè¯
- æ³¨æ„ï¼šä¸‹æ¬¡è¿è¡Œç”Ÿæˆå™¨ä¼šè¦†ç›–æ‰‹åŠ¨ç¼–è¾‘

### è¿è¡Œç”Ÿæˆå™¨

```bash
# åŸºæœ¬ç”¨æ³•ï¼ˆé»˜è®¤ï¼šregistry -> publicï¼Œzh + enï¼‰
python3 tools/registry_build.py

# æŒ‡å®šç›®å½•
python3 tools/registry_build.py --registry-dir registry --output-dir public

# ç¦ç”¨æ ‡ç‚¹æ¸…ç†ï¼ˆç”¨äºè°ƒè¯•ï¼‰
python3 tools/registry_build.py --no-sanitize

# åªå¤„ç†ç‰¹å®šè¯­è¨€
python3 tools/registry_build.py --langs zh
```

### æŸ¥çœ‹éªŒè¯æŠ¥å‘Š

ç”Ÿæˆå™¨ä¼šè‡ªåŠ¨ç”ŸæˆéªŒè¯æŠ¥å‘Šï¼š

- `public/reports/registry-validate.json`ï¼šJSON æ ¼å¼
- `public/reports/registry-validate.md`ï¼šMarkdown æ ¼å¼

æŠ¥å‘ŠåŒ…å«ï¼š
- æ€»å¡ç‰‡æ•°
- æ— æ•ˆå¡ç‰‡åˆ—è¡¨åŠé”™è¯¯åŸå› 
- è­¦å‘Šï¼ˆç©ºå­—æ®µç­‰ï¼‰

---

## æ ‡ç‚¹ç¬¦å·æ¸…ç†

ç”Ÿæˆå™¨é›†æˆäº†æ ‡ç‚¹ç¬¦å·æ¸…ç†åŠŸèƒ½ï¼ˆ1:1 åŒ¹é… `puncc.py` è¡Œä¸ºï¼‰ã€‚

### è§„åˆ™

- **å…¨è§’æ ‡ç‚¹ â†’ åŠè§’æ ‡ç‚¹**ï¼š`ï¼Œã€‚ï¼š""''ï¼ˆï¼‰ã€Šã€‹ã€ã€‘ï¼ï¼Ÿï¼ï¼›`
- **ä¿æŠ¤ä»£ç å—**ï¼šä¸‰é‡åå¼•å·åŒ…è£¹çš„å†…å®¹ä¸ä¼šè¢«æ¸…ç†
- **ä¿æŠ¤ URLs**ï¼š`http://` å’Œ `https://` é“¾æ¥ä¸ä¼šè¢«æ¸…ç†

### ç¦ç”¨æ¸…ç†

```bash
python3 tools/registry_build.py --no-sanitize
```

### ä»£ç å—ä¿æŠ¤ç¤ºä¾‹

```
è¿™æ˜¯æ™®é€šæ–‡æœ¬ï¼Œä¼šè¢«æ¸…ç†ã€‚
```ä»£ç å—å†…å®¹ï¼Œä¸ä¼šè¢«æ¸…ç†```
```

---

## Schema

å®Œæ•´çš„ Schema å®šä¹‰è§ [docs/card-schema.md](docs/card-schema.md)ã€‚

### å¿…éœ€å­—æ®µ

- `glyph`ï¼šè¯­åœºæ’å®šç¬¦å·
- `id`ï¼šæŠ€æœ¯å”¯ä¸€æ ‡è¯†ï¼ˆglyph + langï¼‰
- `lang`ï¼š`"zh" | "en"`
- `kind`ï¼š`"research" | "law" | "directive" | "appendix" | "draft"`
- `title`ï¼šæ ‡é¢˜
- `epoch`ï¼š`{label: string, order: number}`
- `weight`ï¼š`1..5`

### æ ¸å¿ƒå­—æ®µ

- `abstract`ï¼šæ‘˜è¦
- `scope`ï¼šåº”ç”¨èŒƒå›´ï¼ˆæ•°ç»„ï¼‰
- `citation`ï¼šå¼•ç”¨è¯­å¼
- `fragments`ï¼šå…³è” Fragmentï¼ˆæ•°ç»„ï¼‰
- `tags`ï¼šæ ‡ç­¾ï¼ˆæ•°ç»„ï¼Œä»¥ `#` å¼€å¤´ï¼‰
- `authors`ï¼šä½œè€…ï¼ˆæ•°ç»„ï¼‰
- `domains`ï¼šçŸ¥è¯†åŸŸï¼ˆæ•°ç»„ï¼‰
- `layers`ï¼šå±‚ä¸è¯­å—ï¼ˆæ•°ç»„ï¼‰

### ä¿ç•™å­—æ®µï¼ˆå‰ç«¯æš‚ä¸æ¸²æŸ“ï¼‰

- `echo`ï¼šå…³ç³»ç½‘ç»œ
- `observation`ï¼šUI å¯è§æ€§æ ‡å¿—
- `seal`ï¼šé˜²å¾¡/æ³•æ¡ä¸“ç”¨å­—æ®µ
- `origin`ï¼šæ¥æºè¿½æº¯

---

## å‰ç«¯å˜æ›´

### å·²ä¿®å¤çš„ Bug

1. **é‡å¤ DOM ID**ï¼š`timeMenu` â†’ `timeMenuPopup` + `timeMenuOverlay`
2. **è¯­è¨€åˆ‡æ¢ç¡®å®šæ€§**ï¼šç¡®ä¿æ¯æ¬¡ç‚¹å‡»åªè§¦å‘ä¸€æ¬¡é‡è½½
3. **UTANIUM ç”Ÿå‘½å‘¨æœŸ**ï¼š`activateUTANIUM()` ç°åœ¨åœ¨å¡ç‰‡æ¸²æŸ“åæ‰§è¡Œ

### JSON-only åŠ è½½

å‰ç«¯å·²å®Œå…¨ç§»é™¤ TXT è§£æé€»è¾‘ï¼Œæ”¹ä¸ºï¼š

```javascript
async function loadCards(lang) {
  const response = await fetch(`/registry/${lang}/cards.json`);
  const cards = await response.json();
  // ...
}
```

### é˜²å¾¡æ€§æ¸²æŸ“

æ— æ•ˆå¡ç‰‡ä¼šæ˜¾ç¤ºä¸ºï¼š

```
âš ï¸ INVALID CARD
ID: XXX | Title: XXX
Errors:
- Missing required field: ...
```

---

## è¿ç§»æ£€æŸ¥æ¸…å•

- [x] ä¿®å¤å‰ç«¯ç»“æ„ bug
- [x] å®šä¹‰ Schema æ–‡æ¡£
- [x] æ„å»ºç”Ÿæˆå™¨å·¥å…·
- [x] é›†æˆæ ‡ç‚¹æ¸…ç†ï¼ˆ1:1 åŒ¹é…ï¼‰
- [x] æ›¿æ¢å‰ç«¯ä¸º JSON-only
- [x] ç”Ÿæˆ cards.json å¹¶éªŒè¯
- [x] æ·»åŠ æ–‡æ¡£

---

## æ•…éšœæ’é™¤

### ç”Ÿæˆå™¨æŠ¥é”™ï¼šæ‰¾ä¸åˆ°æ–‡ä»¶

æ£€æŸ¥ `registry/{lang}/index.txt` ä¸­çš„æ–‡ä»¶åæ˜¯å¦æ­£ç¡®ã€‚

### å‰ç«¯æ— æ³•åŠ è½½å¡ç‰‡

1. ç¡®è®¤ JSON æ–‡ä»¶å·²ç”Ÿæˆï¼š`public/registry/{lang}/cards.json`
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
3. ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼ˆç›¸å¯¹äºç½‘ç«™æ ¹ç›®å½•ï¼‰

### æ ‡ç‚¹æ¸…ç†ä¸ç¬¦åˆé¢„æœŸ

1. æ£€æŸ¥ä»£ç å—æ˜¯å¦æ­£ç¡®ä½¿ç”¨ä¸‰é‡åå¼•å·åŒ…è£¹
2. ä½¿ç”¨ `--no-sanitize` ç¦ç”¨æ¸…ç†è¿›è¡Œè°ƒè¯•
3. æŸ¥çœ‹ `puncc.py` çš„åŸå§‹è¡Œä¸º

---

## æœªæ¥æ‰©å±•

- [ ] æ”¯æŒæ›´å¤š block ç±»å‹ï¼ˆtable, ascii_diagramï¼‰
- [ ] å®ç° echo å…³ç³»ç½‘ç»œå¯è§†åŒ–
- [ ] æ·»åŠ  seal ç­–ç•¥æ¸²æŸ“
- [ ] æ”¯æŒ JSONL ç¼–è¾‘æ¨¡å¼
- [ ] è‡ªåŠ¨éªŒè¯ CI/CD é›†æˆ

---

## è®¸å¯è¯

[æ ¹æ®é¡¹ç›®è®¸å¯è¯]

